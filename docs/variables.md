# Переменные, используемые в роли

# Переменные, общие на весь кластер

## Инсталляция
| Имя | Значение по умолчанию | Описание |
| ---      | ---      | ---      |
| repo | 'https://download.picodata.io' | репозиторий для установки пакетов, значение для ночных сборок: https://download.binary.picodata.io |
| install_packages | true | требуется ли подключение репозиториев и установка picodata на серверы. Внимание! Даже если выставлена в false на серверах проверяется наличие бинарного файла picodata и, если его нет, то производится подключение репозитория и установка пакета! |
| cluster_id | demo | имя кластера |
| user | root | имя пользователя для файлов |
| group | root | имя группы для файлов |

## Пути
| Имя | Значение по умолчанию | Описание |
| ---      | ---      | ---      |
| conf_dir | /etc/picodata | размещение настроечных файлов |
| data_dir | /var/lib/picodata | размещение данных |
| run_dir | /var/run/picodata | размещение socket-файлов |
| systemd_dir | /etc/systemd/system | размещение systemd-файлов |

## Логирование и аудит
| Имя | Значение по умолчанию | Описание |
| ---      | ---      | ---      |
| log_level | info | уровень логирования. Возможные значения: fatal, system, error, crit, warn, info, verbose, debug |
| log_to | syslog | место хранения лог-файлов. Возможные значения: file, syslog |
| log_dir | /var/log/picodata | место для размещения файлов логирования и аудита |
| audit | false | включение аудита событий в кластере, при включении файлы будут размещаться в log_dir и начинаться с audit- |

## Адреса и порты
| Имя | Значение по умолчанию | Описание |
| ---      | ---      | ---      |
| first_bin_port | 13301 | начальный номер порта для бинарных портов инстансов кластера |
| first_http_port | 18001 | начальный номер порта для http-портов инстансов кластера |
| listen_ip | `{{ansible_default_ipv4.address}}` | Jinja шаблон для определния IP-адреса сервера. В случае нескольких сетевых адресов на сервере можно указать, какой из них использовать, например: `{{ansible_eth1.ipv4.address}}` |

## Прочие
| Имя | Значение по умолчанию | Описание |
| ---      | ---      | ---      |
| service_password | | пароль для сервисной учетной записи pico_service |
| force_remove | false | при выставлении этой переменной в true кластер будет удален |
| purge | false | при выставлении этой переменной в true при удалении кластера будут удалены все файлы: настроечные, данные |
| fd_uniq_per_instance | false | позволяет разворачивать репликасет из нескольких реплик на одном сервере. Испольуется только для тестовых целей! |

---

# Переменные для тира

| Имя | Значение по умолчанию | Описание |
| ---      | ---      | ---      |
| instances_per_server | 1 | количество инстансов тира на каждом сервере |
| replication_factor | 1 | фактор репликации |
| shredding | false | режим безопасного удаления рабочих файлов инстанса путем многократной перезаписи специальными битовыми последовательностями |
| memtx_memory | 64M | количество памяти, предоставляемое непосредственно на хранение данных |

## Размещение тиров по хостам (host_groups)

Групп хостов может быть несколько
```
host_groups:
- STORAGES
```
Если host_groups не определена, то инстансы будут раскатаны на каждом сервере.

Переменная host_group должна быть определена в списке серверов.

## Параметры ядра (tarantool)

Значения для box.cfg
```
tnt_params:
    checkpoint_interval: 7200
```

---

# Переменные для хостов

Пример настройки хостов
```
DC1:                                # Датацентр 1
  hosts:
    server-1-1:                     # Имя сервера 1
      ansible_host: 192.168.19.21   # адрес сервера 1
      host_group: 'ROUTERS'         # группа хостов

DC2:                                # Датацентр 2
  hosts:
    server-2-1:                     # Имя сервера 2
      ansible_host: 192.168.19.22   # адрес сервера 2
      host_group: 'STORAGES'        # группа хостов

DC3:                                # Датацентр 3
  hosts:
    server-3-1:                     # Имя сервера 3
      ansible_host: 192.168.19.23   # адрес сервера 3
      host_group: 'STORAGES'        # группа хостов
```